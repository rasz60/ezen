<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" 
 integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" 
 crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
<title>Watch Position</title>
</head>

<body>

<h3>watchPosition()으로 반복 위치 서비스</h3>
<hr />
<div id="msg">이곳에 위치 정보 출력</div>
<iframe id="map" frameborder="0" scrolling="no" marginheight="0" width="425" height="350" marginwidth="0"></iframe>
<br />


<script>

let options= {
		enableHighAccuracy: false,
		timeout: 5000,
		maximumAge: 0
};

let img = new Image();
let count = 0;
let watchID;

if ( navigator.geolocation ) {
	// warchPosition()의 반환 객체로 중단(clear)시에 사용
	// 위치가 바뀌면 changed가 호출되고, 위치정보가 들어있는 postion 객체를 매개변수로 넘겨준다.
	watchID = navigator.geolocation.watchPosition(changed, null, options);
} else {
	alert('지원 안함');
}



function changed(position) {
	if ( count == 5 ) {
		navigator.geolocation.clearWatch(watchID);
		document.getElementById('msg').innerHTML = '위치 서비스 종료';
		return;
	}
	
	let lat = position.coords.latitude;
	let lon = position.coords.longitude;
	let text = count + ': (위도 ' + lat + '도, 경도 ' + lon + '도)로 변경됨<br/>';
	
	document.getElementById("msg").innerHTML = text;
	
	img.src = "https://maps.googleapis.com/maps/api/staticmap?center=" + lat
	+ "," + lon + "&zoom=13&size=400x300&sensor=false&markers=color:red%7Clabel:C%7C"+lat+"," +lon;
	if(count == 0) // 처음이면 구글 지도 이미지 부착
	    document.getElementById("map").appendChild(img); // 지도 이미지 부착 
	
	    
	count++; 
	
}

</script>
</body>
</html>